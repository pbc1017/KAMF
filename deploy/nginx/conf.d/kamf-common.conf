# Upstream 정의 - 공통 설정

# 운영환경 upstream
upstream kamf_prod_api {
    server kamf-api:8000;
    # 향후 스케일링 시 추가 서버들
    # server kamf-api-2:8000;
}

upstream kamf_prod_web {
    server kamf-web:3000;
    # 향후 스케일링 시 추가 서버들
    # server kamf-web-2:3000;
}

# 개발환경 upstream
upstream kamf_dev_api {
    server kamf-dev-api:8000;
}

upstream kamf_dev_web {
    server kamf-dev-web:3000;
}

# WebSocket 업그레이드를 위한 맵
map $http_upgrade $connection_upgrade {
    default upgrade;
    '' close;
}

# 공통 프록시 설정을 위한 맵
map $scheme $proxy_x_forwarded_proto {
    default $scheme;
    https https;
}
